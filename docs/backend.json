
{
  "entities": {
    "ProductCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductCategory",
      "type": "object",
      "description": "Represents a category of products offered by the printing service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product category."
        },
        "name": {
          "type": "string",
          "description": "Name of the product category (e.g., 'Marketing Prints')."
        },
        "description": {
          "type": "string",
          "description": "Description of the product category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a specific product offered by the printing service.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique, auto-generated identifier for the product."
        },
        "slug": {
          "type": "string",
          "description": "User-editable, URL-friendly identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "name_lower": {
          "type": "string",
          "description": "Lowercase version of the product name for case-insensitive searching."
        },
        "description": {
          "type": "string",
          "description": "Short description of the product for cards and summaries."
        },
        "longDescription": {
          "type": "string",
          "description": "Detailed description for the product page, supports HTML."
        },
        "imageUrls": {
          "type": "array",
          "description": "A list of URLs for the product images (up to 6).",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "mainImageIndex": {
          "type": "number",
          "description": "Index of the main image in the imageUrls array."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to ProductCategory. (Relationship: ProductCategory 1:N Product)"
        },
        "categoryName": {
            "type": "string",
            "description": "The name of the category for denormalization and easier filtering."
        },
        "subcategory": {
            "type": "string",
            "description": "Sub-category for more specific grouping (e.g., 'Premium', 'Kraft')."
        },
        "tags": {
            "type": "array",
            "description": "A list of tags for filtering and searching (e.g., 'matte', 'A5', 'eco-friendly').",
            "items": {
                "type": "string"
            }
        },
        "keywords": {
            "type": "array",
            "description": "Admin-curated keywords for high-priority search matching.",
            "items": {
                "type": "string"
            }
        },
        "searchTerms": {
            "type": "array",
            "description": "An array of aggregated, lowercase tokens for full-text search simulation.",
            "items": {
                "type": "string"
            }
        },
        "price": {
          "type": "number",
          "description": "Base price of the product, used for sorting and display."
        },
        "status": {
            "type": "string",
            "enum": ["Published", "Draft"],
            "description": "Controls the visibility of the product on the public site."
        },
        "featured": {
          "type": "boolean",
          "description": "Indicates if the product is featured on the homepage."
        },
        "seo": {
          "type": "object",
          "description": "SEO-related metadata for the product.",
          "properties": {
            "title": { "type": "string" },
            "description": { "type": "string" },
            "keywords": { "type": "array", "items": { "type": "string" } },
            "ogImage": { "type": "string", "format": "uri" }
          }
        },
        "details": {
          "type": "array",
          "description": "Customization options for the product, like paper type or finish.",
          "items": {
            "type": "object",
            "properties": {
              "label": {
                "type": "string"
              },
              "type": {
                "type": "string",
                "enum": [
                  "dropdown",
                  "text",
                  "number"
                ]
              },
              "placeholder": {
                "type": "string"
              },
              "values": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "value": {
                      "type": "string"
                    },
                    "cost": {
                      "type": "number",
                      "description": "Price adjustment for this specific option value."
                    }
                  }
                }
              }
            }
          }
        },
        "pricing": {
          "type": "object",
          "description": "Complex pricing rules for the product.",
          "properties": {
            "baseCost": {
              "type": "number"
            },
            "tax": {
              "type": "number"
            },
            "addons": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "option": {
                    "type": "string"
                  },
                  "value": {
                    "type": "string"
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "per_unit",
                      "per_order",
                      "multiplier"
                    ]
                  },
                  "cost": {
                    "type": "number"
                  },
                  "active": {
                    "type": "boolean"
                  }
                }
              }
            },
            "tiers": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "minQty": {
                    "type": "number"
                  },
                  "setup": {
                    "type": "number"
                  },
                  "unitCost": {
                    "type": "number"
                  },
                  "margin": {
                    "type": "number"
                  }
                }
              }
            }
          }
        }
      },
      "required": [
        "id",
        "slug",
        "name",
        "description",
        "imageUrls",
        "mainImageIndex",
        "categoryId"
      ]
    },
    "QuoteRequest": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QuoteRequest",
      "type": "object",
      "description": "Represents a quote request submitted by a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quote request."
        },
        "name": {
          "type": "string",
          "description": "Name of the customer submitting the quote request."
        },
        "email": {
          "type": "string",
          "description": "Email address of the customer.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the customer."
        },
        "company": {
          "type": "string",
          "description": "Company name of the customer (if applicable)."
        },
        "details": {
          "type": "string",
          "description": "Details of the quote request, including product specifications and quantities."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N QuoteRequest).  ID of the product the quote is for."
        },
        "productName": {
          "type": "string",
          "description": "Name of the product the quote is for."
        },
        "submissionDate": {
          "type": "string",
          "description": "Date and time the quote request was submitted.",
          "format": "date-time"
        },
        "artworkUrls": {
          "type": "array",
          "description": "A list of URLs for the customer's uploaded artwork.",
          "items": {
            "type": "string",
            "format": "uri"
          }
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "phone",
        "details",
        "productId",
        "productName",
        "submissionDate"
      ]
    },
    "Quote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quote",
      "type": "object",
      "description": "Represents a formal quote generated by an admin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quote."
        },
        "customerId": {
          "type": "string",
          "description": "ID of the customer this quote is for."
        },
        "company": {
          "type": "string"
        },
        "email": {
          "type": "string",
          "format": "email"
        },
        "phone": {
          "type": "string"
        },
        "dueDate": {
          "type": "string",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "enum": [
            "draft",
            "sent",
            "won",
            "lost"
          ]
        },
        "lineItems": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "productId": {
                "type": "string"
              },
              "productName": {
                "type": "string"
              },
              "qty": {
                "type": "number"
              },
              "unitPrice": {
                "type": "number"
              },
              "options": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "label": {
                      "type": "string"
                    },
                    "value": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "notesCustomer": {
          "type": "string"
        },
        "notesInternal": {
          "type": "string"
        },
        "discount": {
          "type": "number"
        },
        "vatRate": {
          "type": "number"
        },
        "delivery": {
          "type": "number"
        },
        "subtotal": {
          "type": "number"
        },
        "vat": {
          "type": "number"
        },
        "total": {
          "type": "number"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        },
        "artworkUrls": {
          "type": "array",
          "description": "A list of URLs for the customer's uploaded artwork, carried over from the quote request.",
          "items": {
            "type": "string",
            "format": "uri"
          }
        }
      },
      "required": [
        "id",
        "email",
        "status",
        "lineItems",
        "subtotal",
        "vat",
        "total",
        "createdAt",
        "updatedAt"
      ]
    },
    "Testimonial": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Testimonial",
      "type": "object",
      "description": "Represents a customer testimonial or review.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the testimonial."
        },
        "name": {
          "type": "string",
          "description": "Name of the person giving the testimonial."
        },
        "company": {
          "type": "string",
          "description": "Company of the person (optional)."
        },
        "quote": {
          "type": "string",
          "description": "The content of the testimonial."
        },
        "rating": {
          "type": "number",
          "description": "Star rating from 1 to 5."
        },
        "visible": {
          "type": "boolean",
          "description": "Controls whether the testimonial is visible on the public website."
        },
        "imageUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL for the customer's avatar image (optional)."
        }
      },
      "required": [
        "id",
        "name",
        "quote",
        "rating",
        "visible"
      ]
    },
    "Promo": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Promo",
      "type": "object",
      "description": "Represents a marketing promotion, like a popup or banner.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the promotion."
        },
        "title": {
          "type": "string",
          "description": "The main headline of the promotion."
        },
        "description": {
          "type": "string",
          "description": "The body text of the promotion."
        },
        "imageUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL for a background or feature image."
        },
        "backgroundColor": {
          "type": "string",
          "description": "Background color for the promo popup (hex code)."
        },
        "ctaText": {
          "type": "string",
          "description": "Text for the call-to-action button."
        },
        "ctaLink": {
          "type": "string",
          "description": "The destination URL for the CTA button."
        },
        "placement": {
          "type": "string",
          "enum": [
            "popup",
            "top-banner"
          ],
          "description": "Where the promotion should be displayed."
        },
        "active": {
          "type": "boolean",
          "description": "Controls whether the promotion is currently active."
        },
        "startDate": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the promotion becomes active."
        },
        "endDate": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the promotion expires."
        },
        "displayIntervalHours": {
          "type": "number",
          "description": "For popups, the number of hours to wait before showing again to the same user."
        },
        "autoDismissSeconds": {
          "type": "number",
          "description": "For banners, number of seconds before it auto-hides. 0 for never."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "ctaText",
        "ctaLink",
        "placement",
        "active"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer in the system.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the customer." },
        "name": { "type": "string", "description": "Full name of the customer." },
        "name_lower": { "type": "string", "description": "Lowercase version of name for case-insensitive search." },
        "email": { "type": "string", "format": "email", "description": "Email address of the customer." },
        "phone": { "type": "string", "description": "Phone number of the customer." },
        "company": { "type": "string", "description": "Company of the customer (optional)." },
        "notes": { "type": "string", "description": "Internal notes about the customer (optional)." },
        "createdAt": { "type": "string", "format": "date-time", "description": "Timestamp when the customer was created." },
        "updatedAt": { "type": "string", "format": "date-time", "description": "Timestamp when the customer was last updated." }
      },
      "required": ["id", "name", "email", "createdAt", "updatedAt"]
    },
    "FAQ": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "FAQ",
        "type": "object",
        "description": "Represents a frequently asked question.",
        "properties": {
            "id": { "type": "string", "description": "Unique identifier for the FAQ." },
            "question": { "type": "string", "description": "The question text." },
            "answer": { "type": "string", "description": "The answer text." },
            "category": { "type": "string", "description": "Category for the FAQ (e.g., Shipping, Payment)." },
            "visible": { "type": "boolean", "description": "Controls if the FAQ is visible to the public." }
        },
        "required": ["id", "question", "answer", "category", "visible"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/roles_admin/{uid}",
        "definition": {
          "entityName": "user",
          "schema": {
            "$ref": "#/backend/entities/user"
          },
          "description": "Collection to store admin user IDs. Existence of a document indicates admin role.",
          "params": [
            {
              "name": "uid",
              "description": "User ID of the administrator."
            }
          ]
        }
      },
      {
        "path": "/product_categories/{productCategoryId}",
        "definition": {
          "entityName": "ProductCategory",
          "schema": {
            "$ref": "#/backend/entities/ProductCategory"
          },
          "description": "Collection to store product categories. Accessible publicly for reads, writeable only by admins.",
          "params": [
            {
              "name": "productCategoryId",
              "description": "Unique identifier for the product category."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Collection to store product information. Accessible publicly for reads, writeable only by admins.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/quote_requests/{quoteRequestId}",
        "definition": {
          "entityName": "QuoteRequest",
          "schema": {
            "$ref": "#/backend/entities/QuoteRequest"
          },
          "description": "Collection to store customer quote requests. Accessible only by admins.",
          "params": [
            {
              "name": "quoteRequestId",
              "description": "Unique identifier for the quote request."
            }
          ]
        }
      },
      {
        "path": "/quotes/{quoteId}",
        "definition": {
          "entityName": "Quote",
          "schema": {
            "$ref": "#/backend/entities/Quote"
          },
          "description": "Collection to store admin-generated quotes. Accessible only by admins.",
          "params": [
            {
              "name": "quoteId",
              "description": "Unique identifier for the quote."
            }
          ]
        }
      },
      {
        "path": "/testimonials/{testimonialId}",
        "definition": {
          "entityName": "Testimonial",
          "schema": {
            "$ref": "#/backend/entities/Testimonial"
          },
          "description": "Collection to store customer testimonials. Publicly readable if visible, writeable by admins.",
          "params": [
            {
              "name": "testimonialId",
              "description": "Unique identifier for the testimonial."
            }
          ]
        }
      },
      {
        "path": "/promos/{promoId}",
        "definition": {
          "entityName": "Promo",
          "schema": {
            "$ref": "#/backend/entities/Promo"
          },
          "description": "Collection for marketing promotions. Publicly readable if active, writeable by admins.",
          "params": [
            {
              "name": "promoId",
              "description": "Unique identifier for the promotion."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Collection to store customer information. Writeable only by admins in production.",
          "params": [
            {
              "name": "customerId",
              "description": "Unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/faqs/{faqId}",
        "definition": {
          "entityName": "FAQ",
          "schema": {
            "$ref": "#/backend/entities/FAQ"
          },
          "description": "Collection to store frequently asked questions. Publicly readable if visible, writeable by admins.",
          "params": [
            {
              "name": "faqId",
              "description": "Unique identifier for the FAQ."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure prioritizes security, scalability, and ease of debugging, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It addresses the user's requirement for a secure admin page to manage products, categories, and customer quote requests, along with a summary dashboard.\n\n**Authorization Independence:**\n*   Admin Access: The `/roles_admin/{uid}` collection grants admin privileges. The existence of a document for a user ID in this collection signifies admin access. No data from other documents is required to validate admin privileges.\n\n*   No Hierarchical `get()` calls: All paths are independent and do not require reading parent documents to determine authorization.\n\n**Structural Segregation:**\n*   Admin Data Segregation: Admin-managed data (products, categories, quote requests, promos) is stored separately, allowing specific security rules to be applied.\n\n**Access Modeling:**\n*   Global Roles (DBAC): Admin roles are managed using the `/roles_admin/{uid}` collection, enabling simple existence-based security rules.\n\n**QAPs (Rules Are Not Filters):**\n*   The segregation of data into different collections based on access requirements supports secure `list` operations. For example, listing products or categories only requires read access to those specific collections, which is granted based on admin role.\n\n**Specific Path Explanations:**\n*   `/roles_admin/{uid}`:  This collection uses **Existence over Content** to assign admin roles. The existence of a document with a specific `uid` grants admin privileges to that user.\n*   `/product_categories/{productCategoryId}`: Stores product category information. Only admins can create, read, update, or delete documents in this collection.\n*   `/products/{productId}`: Stores product information. Only admins can create, read, update, or delete documents in this collection. \n*   `/quote_requests/{quoteRequestId}`: Stores customer quote requests. Only admins can read requests.\n*   `/faqs/{faqId}`: Stores frequently asked questions. Publicly readable if visible, writeable by admins.\n"
  }
}

    