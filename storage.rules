
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Match the folder where product images are stored.
    match /products/{allPaths=**} {

      // Allow anyone to read files from this path.
      // This is necessary to display product images on your public website.
      allow read: if true;

      // Allow write (create, update, delete) operations ONLY if the user
      // is authenticated AND is an admin.
      // This checks for the user's document in the 'roles_admin' collection in Firestore.
      allow write: if request.auth != null && 
                      exists(/databases/$(database)/documents/roles_admin/$(request.auth.uid));
    }
    
    // Match the folder where artwork for quote requests is stored.
    match /quote-artwork/{quoteId}/{allPaths=**} {
      
      // Allow anyone to read files from this path.
      allow read: if true;
      
      // Allow anyone to upload (create) files, but with restrictions.
      // This is for public quote request submissions.
      allow create: if request.resource.size < 25 * 1024 * 1024
                      && request.resource.contentType.matches('image/.*|application/pdf|application/postscript|application/vnd.adobe.illustrator');
      
      // Only admins can update or delete artwork.
      allow update, delete: if request.auth != null &&
                              exists(/databases/$(database)/documents/roles_admin/$(request.auth.uid));
    }
  }
}
